{% extends "layout.html" %}

{% block title %}Birthdays{% endblock %}
{% block header %}Birthdays{% endblock %}

{% block main %}
    <div class="p-4 md:p-8 flex flex-col gap-4 items-center">
        <form action="/" method="POST" class="max-w-md w-full mx-auto">
            <div class="mb-5">
                <label for="name" class="block mb-2 text-sm font-medium text-slate-950">Name</label>
                <input type="text" name="name" id="name" placeholder="Enter name" autofocus class="p-2 rounded-sm border w-full" required>
            </div>
            <div class="mb-5">
                <label for="date" class="block mb-2 text-sm font-medium text-slate-950">Date</label>
                <input type="date" name="date" id="date" class="p-2 rounded-sm border w-full" required>
            </div>
            <button type="submit" class="w-full text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 me-2 mb-2">Submit</button>
        </form>
        <p class="text-red-500 text-sm">{% if error %} {{ error }} {% endif %}</p>
    </div>

    <div class="relative overflow-x-auto px-4">
        <table class="table-auto mx-auto w-full max-w-xl text-sm text-center text-gray-950 border border-gray-400">
            <thead class="text-xs text-gray-700 uppercase bg-gray-50 border-b border-gray-400">
                <tr class="border">
                    <th scope="col" class="px-6 py-3">ID</th>
                    <th scope="col" class="px-6 py-3 text-left">Name</th>
                    <th scope="col" class="px-6 py-3">Birthday</th>
                    <th scope="col" class="px-6 py-3">Action</th>
                </tr>
            </thead>
            <tbody>
                {% for birthday in birthdays %}
                    <tr class="bg-white border-b border-gray-400">
                        <td class="px-6 py-4">{{ birthday.id }}</td>
                        <td class="px-6 py-4 text-left">{{ birthday.name }}</td>
                        <td class="px-6 py-4">{{ birthday.date }}</td>
                        <td class="px-6 py-4 flex gap-2 items-center justify-center">
                            <a href="/update/{{ birthday.id }}" title="update entry" class="hover:scale-90 transition-all">
                                <svg xmlns="http://www.w3.org/2000/svg" class="size-5 text-gray-600" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-square-pen-icon lucide-square-pen">
                                    <path d="M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7" />
                                    <path d="M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z" />
                                </svg>
                            </a>
                            <div>
                                <button class="open-dialog-btn rounded-md px-2.5 py-1.5 text-sm font-semibold text-gray-900 hover:scale-90 transition-all">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="size-5 text-red-500" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-trash2-icon lucide-trash-2">
                                        <path d="M3 6h18" />
                                        <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6" />
                                        <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2" />
                                        <line x1="10" x2="10" y1="11" y2="17" />
                                        <line x1="14" x2="14" y1="11" y2="17" />
                                    </svg>
                                </button>

                                <div class="dialog hidden relative z-10" aria-labelledby="dialog-title" role="dialog" aria-modal="true">
                                    <div class="fixed inset-0 bg-gray-500/75 transition-opacity" aria-hidden="true"></div>

                                    <div class="fixed inset-0 z-10 w-screen overflow-y-auto">
                                        <div class="flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0">
                                            <div class="relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg">
                                                <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                                                    <div class="sm:flex sm:items-start">
                                                        <div class="mx-auto flex size-12 shrink-0 items-center justify-center rounded-full bg-red-100 sm:mx-0 sm:size-10">
                                                            <svg class="size-6 text-red-600" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">
                                                                <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126ZM12 15.75h.007v.008H12v-.008Z" />
                                                            </svg>
                                                        </div>
                                                        <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left">
                                                            <h3 class="text-base font-semibold text-gray-900" id="dialog-title">Delete {{ birthday.name }}'s birthday</h3>
                                                            <div class="mt-2">
                                                                <p class="text-sm text-gray-500">Are you sure you want to delete this entry? The data will be permanently removed. This action cannot be undone.</p>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="bg-gray-50 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6">
                                                    <a href="/delete/{{ birthday.id }}" type="button" class="inline-flex w-full justify-center rounded-md bg-red-600 px-3 py-2 text-sm font-semibold text-white shadow-xs hover:bg-red-500 sm:ml-3 sm:w-auto">Delete</a>
                                                    <button type="button" class="cancel-dialog-btn mt-3 inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-xs ring-1 ring-gray-300 ring-inset hover:bg-gray-50 sm:mt-0 sm:w-auto">Cancel</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </td>
                    </tr>
                {% endfor %}
                <script>
                    document.addEventListener("DOMContentLoaded", function() {
                        const openButtons = document.querySelectorAll(".open-dialog-btn");
                        const cancelButtons = document.querySelectorAll(".cancel-dialog-btn");
                        const dialogs = document.querySelectorAll(".dialog");

                        openButtons.forEach((openBtn, index) => {
                            const dialog = dialogs[index];
                            const cancelBtn = cancelButtons[index];

                            openBtn.addEventListener("click", () => {
                                dialog.classList.remove("hidden");
                            });

                            cancelBtn.addEventListener("click", () => {
                                dialog.classList.add("hidden");
                            });

                            dialog.addEventListener("click", (e) => {
                                if (e.target === dialog || e.target.classList.contains("bg-gray-500/75")) {
                                    dialog.classList.add("hidden");
                                }
                            });
                        });
                    });
                </script>
            </tbody>
        </table>
    </div>
{% endblock %}
